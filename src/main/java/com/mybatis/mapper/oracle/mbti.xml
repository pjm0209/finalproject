<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team2.mbti.mbtisurvey.model.MbtiSurveyDAO">
	<sql id="searchMbti">
		<where>
			<if test="searchKeyword!=null and searchKeyword!=''">
	        	${searchCondition} like '%' || #{searchKeyword} || '%'
	        </if>
        </where>
	</sql>
	<insert id="insertMbtiSurvey" parameterType="mbtiSurveyVo">
		<selectKey keyProperty="mbtiServeyNo" order="BEFORE" resultType="int">
			select mbti_survey_seq.nextval from dual
		</selectKey>
		insert into mbti_survey(mbti_servey_no,question_type_no,question_category_no,question)
		values(#{mbtiServeyNo},#{questionTypeNo},#{questionCategoryNo},#{question})
	</insert>
	<select id="selectAllMbtiSurvey" parameterType="searchVo" resultType="mbtiSurveyVo">
		select * from
		(
		    select rownum RNUM,a.* from
		    (
		        select * from mbti_survey 
		        <include refid="searchMbti"></include>
		        order by mbti_servey_no
		    )a
		)
		<![CDATA[
		where RNUM > #{firstRecordIndex} and RNUM <= #{firstRecordIndex} + #{recordCountPerPage}]]>
	</select>
	
	<select id="getTotalRecordMbti" parameterType="searchVo" resultType="int">
		select count(*) from mbti_survey
		<include refid="searchMbti"></include> 
	</select>
	
	<select id="selectByNoMbtiSurvey" resultType="mbtiSurveyVo">
		select * from mbti_survey where mbti_servey_no=#{mbtiServeyNo}
	</select>
	
	<update id="updateMbtiSurvey" parameterType="mbtiSurveyVo">
		update mbti_survey
		set question_type_no = #{questionTypeNo}, question_category_no = #{questionCategoryNo}, question = #{question}
		where mbti_servey_no = #{mbtiServeyNo}
	</update>
	
	<delete id="deleteMbtiSurvey" parameterType="mbtiSurveyVo">
		delete from mbti_survey
		where mbti_servey_no = #{mbtiServeyNo}
	</delete>
	
	<select id="selectByQuestionTypeNoMbtiSurvey" parameterType="int" resultType="mbtiSurveyVo">
		select * from mbti_survey where question_type_no=#{questionTypeNo}
	</select>
</mapper>